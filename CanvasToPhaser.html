<!DOCTYPE html>
<html>
<head>
    <title>Smooth Game Loop with Key Controls</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
</head>
<body>
    <script>
        class StarterScene extends Phaser.Scene {
            constructor() {
                super({ key: 'StarterScene' });
            }
        
            preload() {
                // Preload assets for start scene
                this.load.image('startButton', 'assets/crab.png');
            }
        
            create() {
                // Set background color to light blue
                this.cameras.main.setBackgroundColor('#add8e6');
        
                // Add a start button
                const startButton = this.add.image(config.width / 2, config.height / 2, 'startButton').setInteractive();
                startButton.on('pointerup', () => {
                    // Switch to the main game scene when the button is clicked
                    this.scene.start('MainGameScene');
                });
            }
        }

        let player;
        let cursors;
        let items;
        let score = 0;
        let scoreText;

        class MainGameScene extends Phaser.Scene {
            constructor() {
                super({ key: 'MainGameScene' });
            }

            preload() {
                this.load.image('player', 'assets/crab.webp');
                this.load.image('item', 'assets/shrimp.png');
            }

            create() {
                // Set background color to light blue
                this.cameras.main.setBackgroundColor('#add8e6');
                player = this.physics.add.sprite(50, config.height - 50, 'player').setScale(0.5);
                player.setGravityY(0); // Disable gravity for player
                cursors = this.input.keyboard.createCursorKeys();
                items = this.physics.add.group();
            
                scoreText = this.add.text(16, 16, 'Score: 0', { fontSize: '32px', fill: '#000' });
            
                this.physics.add.collider(player, items, this.collectItem, null, this);
            
                this.time.addEvent({
                    delay: 2000,
                    callback: this.addNewItem,
                    callbackScope: this,
                    loop: true
                });
            }
            
            update() {
                // Handles player movement
                if (cursors.left.isDown && player.x > 50) {
                    player.setVelocityX(-200);
                } else if (cursors.right.isDown && player.x < config.width - player.displayWidth / 2) {
                    player.setVelocityX(200);
                } else {
                    player.setVelocityX(0);
                }
            }

            addNewItem() {
                const itemX = Phaser.Math.Between(0, config.width - 20);
                const item = items.create(itemX, 0, 'item').setScale(0.5);
                item.setVelocityY(100);
            }

            collectItem(player, item) {
                item.destroy();
                score += 10;
                scoreText.setText('Score: ' + score);
                player.body.setVelocityY(0); // Player's velocity should stay at zero for y axis
                if (score >= 100){
                    this.scene.start('HardGameScene');
                }
            }
        }

        class HardGameScene extends Phaser.Scene {
            constructor() {
                super({ key: 'HardGameScene' });
            }
        
            preload() {
                // Preload assets for harder game scene
                this.load.image('player', 'assets/crab.webp');
                this.load.image('regularItem', 'assets/shrimp.png');
                this.load.image('infectedItem', 'assets/infectedShrimp.png');
            }
        
            create() {
                // Set background color to a different color
                this.cameras.main.setBackgroundColor('#ff0000');
        
                // Initialize player, items, and score
                player = this.physics.add.sprite(50, config.height - 50, 'player').setScale(0.5);
                player.setGravityY(0); // Disable gravity for player
                cursors = this.input.keyboard.createCursorKeys();
                items = this.physics.add.group();
                score = 100; // Make sure the player starts hard mode with 100 points
                scoreText = this.add.text(16, 16, 'Score: ' + score, { fontSize: '32px', fill: '#000' });
        
                // Set up item generation
                this.time.addEvent({
                    delay: 2000,
                    callback: this.addNewItem,
                    callbackScope: this,
                    loop: true
                });
        
                // Set up collision detection
                this.physics.add.collider(player, items, this.collectItem, null, this);
            }
        
            update() {
                // Handles player movement
                if (cursors.left.isDown && player.x > 0) {
                    player.setVelocityX(-200);
                } else if (cursors.right.isDown && player.x < config.width - player.displayWidth / 2) {
                    player.setVelocityX(200);
                } else {
                    player.setVelocityX(0);
                }
        
                // Check if the score drops below zero
                if (score <= 0) {
                    score = 0;
                    player.destroy(); // Remove the player from the game if score drops below zero

                }
            }
        
            addNewItem() {
                // Spawn new items (regular or infected shrimp)
                const itemX = Phaser.Math.Between(0, config.width - 20);
                const itemType = Math.random() < 0.6 ? 'regularItem' : 'infectedItem'; // 60% chance for regular shrimp, 40% chance for infected shrimp
                const item = items.create(itemX, 0, itemType).setScale(0.5);
                item.setVelocityY(150);
            }
        
            collectItem(player, item) {
                // Handle item collection
                if (item.texture.key === 'regularItem') {
                    score += 10; // Add points for collecting regular shrimp
                } else if (item.texture.key === 'infectedItem') {
                    score -= 50; // Minus points for collecting infected shrimp
                }
        
                scoreText.setText('Score: ' + score);
                player.body.setVelocityY(0); // Player's velocity should stay at zero for y axis
                item.destroy();
            }
        }
        

        // Config of the game
        const config = {
            type: Phaser.AUTO,
            width: 400,
            height: 400,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: false
                }
            },
            scene: [StarterScene, MainGameScene, HardGameScene]
        };

        const game = new Phaser.Game(config);
                
    </script>
</body>
</html>
